.\"
.\" Japanese Version Copyright (c) 2019 Yuichi SATO
.\"         all rights reserved.
.\" Translated Sat Jul 13 20:31:16 JST 2019
.\"         by Yuichi SATO <ysato444@ybb.ne.jp>
.\"
.TH TAPESTAT 1 "JULY 2018" Linux "Linux User's Manual" -*- nroff -*-
.\"O .SH NAME
.SH 名前
.\"O tapestat \- Report tape statistics.
tapestat \- テープの統計をレポートする。
.\"O .SH SYNOPSIS
.SH 書式
.B tapestat [ -k | -m ] [ -t ] [ -V ] [ -y ] [ -z ] [ --human ] [
.I interval
.B [
.I count
.B ] ]
.\"O .SH DESCRIPTION
.SH 説明
.\"O The
.\"O .B tapestat
.\"O command is used for monitoring the activity of tape drives connected to a system.
.B tapestat
コマンドはシステムに接続されたテープの活性度をモニタリングする。

.\"O The first report generated by the
.\"O .B tapestat
.\"O command provides statistics
.\"O concerning the time since the system was booted, unless the
.\"O .B -y
.\"O option is used, when this first report is omitted.
.B tapestat
コマンドが生成する最初のレポートとして、
システムがブートしてからの時間の統計が提供される。
.B -y
オプションが使われると、最初のレポートが省略される。

.\"O Each subsequent report
.\"O covers the time since the previous report.
その後のレポートは、最初のレポートからの時間がカバーされる。

.\"O The
.\"O .I interval
.\"O parameter specifies the amount of time in seconds between
.\"O each report.
.I interval
パラメータは各レポート間の時間を指定する。
.\"O The
.\"O .I count
.\"O parameter can be specified in conjunction with the
.\"O .I interval
.\"O parameter. If the
.\"O .I count
.\"O parameter is specified, the value of
.\"O .I count
.\"O determines the number of reports generated at
.\"O .I interval
.\"O seconds apart. If the
.\"O .I interval
.\"O parameter is specified without the
.\"O .I count
.\"O parameter, the
.\"O .B tapestat
.\"O command generates reports continuously.
.I count
パラメータは
.I interval
パラメータと組み合わせて使われる。
.I count
パラメータが指定されると、
.I count
は
.I interval
秒ごとに生成される回数を決定する。
.I count
パラメータを指定せずに
.I interval
パラメータを指定すると、
.B tapestat
コマンドは連続してレポートを生成する。

.\"O .SH REPORT
.SH レポート
.\"O The
.\"O .B tapestat
.\"O report provides statistics for each tape drive connected to the system.
.\"O The following data are displayed:
.B tapestat
はシステムに接続されたテープドライブの統計をレポートする。
以下のデータが表示される。

.B r/s 
.RS
.\"O The number of reads issued expressed as the number per second averaged over the interval.
interval の期間に発行された読み込み転送の 1 秒あたりの平均回数。

.RE
.B w/s
.RS
.\"O The number of writes issued expressed as the number per second averaged over the interval.
interval の期間に発行された書き込み転送の 1 秒あたりの平均回数。

.RE
.B kB_read/s | MB_read/s
.RS
.\"O The amount of data read expressed in kilobytes (by default or if option -k used) or
.\"O megabytes (if option -m used) per second averaged over the interval.
interval の期間の読み込み転送量の 1 秒あたりの平均値。
(デフォルト、またはオプション -k が指定された場合) キロバイト、
(オプション -m が指定された場合) メガバイト。

.RE
.B kB_wrtn/s | MB_wrtn/s
.RS
.\"O The amount of data written expressed in kilobytes (by default or if option -k used) or
.\"O megabytes (if option -m used) per second averaged over the interval.
interval の期間の書き込み転送量の 1 秒あたりの平均値。
(デフォルト、またはオプション -k が指定された場合) キロバイト、
(オプション -m が指定された場合) メガバイト。

.RE
.B %Rd
.RS
.\"O Read percentage wait - The percentage of time over the interval spent waiting for read requests
.\"O to complete.
読み込み待ちの割合 - interval の期間に、読み込みリクエストの完了を
待つのに使った時間の割合。
.\"O The time is measured from when the request is dispatched to the SCSI mid-layer until it signals
.\"O that it completed.
SCSI 中間レイヤーにリクエストが送信されてから、
リクエストが完了するまでの時間が計測される。

.RE
.B %Wr
.RS
.\"O Write percentage wait - The percentage of time over the interval spent waiting for write requests
.\"O to complete. The time is measured from when the request is dispatched to the SCSI mid-layer until
.\"O it signals that it completed.
書き込み待ちの割合 - interval の期間に、書き込みリクエストの完了を
待つのに使った時間の割合。
SCSI 中間レイヤーにリクエストが送信されてから、
リクエストが完了するまでの時間が計測される。

.RE
.B %Oa
.RS
.\"O Overall percentage wait - The percentage of time over the interval spent waiting for any
.\"O I/O request to complete (read, write, and other).
待ち全体の割合 - interval の期間に、I/O リクエスト
(読み込み、書き込み、その他) の完了を待つのに使った時間の割合。

.RE
.B Rs/s
.RS
.\"O The number of I/Os, expressed as the number per second averaged over the interval, where
.\"O a non-zero residual value was encountered.
0 以外の未処理の値に当たって、
interval の期間に転送された I/O の回数の平均値。

.RE
.B Ot/s
.RS
.\"O The number of I/Os, expressed as the number per second averaged over the interval, that
.\"O were included as "other". Other I/O includes ioctl calls made to the tape driver and
.\"O implicit operations performed by the tape driver such as rewind on close
.\"O (for tape devices that implement rewind on close). It does not include any I/O performed
.\"O using methods outside of the tape driver (e.g. via sg ioctls).
「その他」の I/O を含む、interval の期間に転送された I/O の回数の平均値。
その他の I/O には、テープドライバに対する ioctl 呼び出しと、
(クローズ時の巻き戻しが実装されたテープデバイスに対する)
クローズ時の巻き戻しといった、テープドライバによって
実行される暗黙の操作が含まれる。
これには　(例えば sg ioctl を使った) テープドライバ以外の
方法を使った I/O が含まれない。
.RE
.RE
.\"O .SH OPTIONS
.SH オプション
.IP --human
.\"O Print sizes in human readable format (e.g. 1.0k, 1.2M, etc.)
.\"O The units displayed with this option supersede any other default units (e.g.
.\"O kilobytes, sectors...) associated with the metrics.
サイズを人間が読みやすいフォーマット (例えば 1.0k, 1.2M など) で表示する。
このオプションで表示される単位は、指標に紐付けられたデフォルトの単位
(例えば、キロバイト、セクターなど) を上書きする。
.IP -k
.\"O Show the amount of data written or read in kilobytes per second instead of megabytes.
.\"O This option is mutually exclusive with -m.
読み書きされたデータ量を、メガバイトではなく、
キロバイトで表示する。
このオプションは -m とどちらか一方しか指定できない。
.IP -m
.\"O Show the amount of data written or read in megabytes per second instead of kilobytes.
.\"O This option is mutually exclusive with -k.
読み書きされたデータ量を、キロバイトではなく、
メガバイトで表示する。
このオプションは -k とどちらか一方しか指定できない。
.IP -t
.\"O Display time stamps. The time stamp format may depend
.\"O on the value of the S_TIME_FORMAT environment variable (see below).
タイムスタンプを表示する。
タイムスタンプのフォーマットは、S_TIME_FORMAT 環境変数の値に依存する
(下記を参照)。
.IP -V
.\"O Print version and exit.
バージョン番号を表示して、終了する。
.IP -y
.\"O Omit the initial statistic showing values since boot.
ブートからの最初の統計の表示を省略する。
.IP -z
.\"O Tell
.\"O .B tapestat
.\"O to omit output for any tapes for which there was no activity
.\"O during the sample period.
サンプリング期間に何も活動がない場合、
.B tapestat
に出力を省略させる。

.\"O .SH CONSIDERATIONS
.SH 考慮点
.\"O It is possible for a percentage value (read, write, or other) to be greater than 100 percent
.\"O (the
.\"O .B tapestat
.\"O command will never show a percentage value more than 999).
割合の値 (読み込み、書き込み、その他) は、100% より大きくなる可能性がある
.RB ( tapestat
コマンドは 999% より大きい値を表示しない)。
.\"O If rewinding a tape takes 40 seconds where the interval time is 5 seconds the %Oa value
.\"O would show as 0 in the intervals before the rewind completed and then show as approximately
.\"O 800 percent when the rewind completes.
テープの巻き戻しに 40 秒かかり、interval 時間が 5 秒の場合、
巻き戻しが完了するまでの期間では %Oa の値は 0 であり、
巻き戻しが完了した後では約 800% になる。

.\"O Similar values will be observed for %Rd and %Wr if a tape drive stops reading or writing
.\"O and then restarts (that is it stopped streaming). In such a case you may see the r/s or w/s drop to zero and the %Rd/%Wr value could be higher than 100 when reading or writing continues
.\"O (depending on how long it takes to restart writing or reading).
テープドライブが読み込みや書き込みを止めて、リスタート (つまりストリーミングを停止) した場合、
同様の値が %Rd と %Wr にも見られる。
このような場合、読み込みまたは書き込みが引き続いて起こると
(読み込みや書き込みが再開されるまでにどのくらいかかるかに依存して)、
r/s または w/s は 0 に落ち込み、
%Rd/%Wr の値は 100 より大きくなるだろう。
.\"O This is only an issue if it happens a lot as it may cause tape wear and will impact
.\"O on the backup times.
.\"O:
.\"O: cause tape ware の訳しかたに自信なし。
.\"O: 
これは多発する場合にのみ問題になり、テープ摩耗の原因になり、
バックアップ時間に影響が出る。

.\"O For fast tape drives you may see low percentage wait times.
速いテープドライブでは待ち時間の割合が低いだろう。
.\"O This does not indicate an issue with the tape drive. For a slower tape drive (e.g. an older
.\"O generation DDS drive) the speed of the tape (and tape drive) is much slower than filesystem I/O,
.\"O percent wait times are likely to be higher. For faster tape drives (e.g. LTO) the percentage
.\"O wait times are likely to be lower as program writing to or reading from tape is going
.\"O to be doing a lot more filesystem I/O because of the higher throughput.
これはテープドライブに問題があることを表している訳ではない。
遅いテープドライブ (例えば古い世代の DDS ドライブ) では、
テープ (とテープドライブ) の速度はファイルシステム I/O よりかなり遅く、
待ち時間の割合は高くなりやすい。
速いテープドライブ (例えば LTO) では、スループットが高いので、
テープに対する書き出しまた読み込みは、ファイルシステム I/O より良くなるため、
待ち時間の割合は低くなる。

.\"O Although tape statistics are implemented in the kernel using atomic variables they cannot be
.\"O read atomically as a group. All of the statistics values are read from different files under
.\"O /sys, because of this there may be I/O completions while reading the different files for the
.\"O one tape drive. This may result in a set of statistics for a device that contain some values
.\"O before an I/O completed and some after.
テープの統計はカーネル内のアトミックな値を使って実装されているが、
グループとしてはアトミックに読み込まれていない。
全ての統計値は /sys 以下の別々のファイルから読み込まれているため、
1 つのテープドライブについて別々のファイルを読んでいる間に、
I/O が完了してしまうことがある。
これにより、デバイスの統計の値の中には、I/O が完了する前に決まるものと、
完了した後に決まるものがある。

.\"O This command uses rounding down as the rounding method when calculating per second statistics.
このコマンドは 1 秒あたりの統計値を計算する際の丸め方法として、切り捨てを行う。
.\"O If, for example, you are using dd to copy one tape to another and running
.\"O .B tapestat
.\"O with an interval of 5 seconds and over the interval there were 3210 writes and 3209 reads
.\"O then w/s would show 642 and r/s 641 (641.8 rounded down to 641). In such a case if it was
.\"O a tar archive being copied (with a 10k block size) you would also see a difference between
.\"O the kB_read/s and kB_wrtn/s of 2 (one I/O 10k in size divided by the interval period of 5
.\"O seconds). If instead there were 3210 writes and 3211 reads both w/s and r/s would both show
.\"O 642 but you would still see a difference between the kB_read/s and kB_wrtn/s values of 2 kB/s.
例えば、dd を使って 1 つのテープから別のテープにコピーする時に、
.B tapestat
を時間間隔 5 秒で動作させた場合に、時間間隔の間に 3210 回の書き込みと
3209 回の読み込みがとすると、
w/s は 642、 r/s は 641 となる (641.8 は 641 に切り捨てられる)。
このような場合に、 tar アーカイブを (10k ブロックサイズで) コピーすると、
kB_read/s と kB_wrtn/s の差が 2 となるだろう
(1 回の I/O サイズ 10k が時間間隔 5 秒で割られて 2 となる)。
3210 回の書き込みと 3211 回の読み込みの場合、w/s と r/s はともに 642 となるが、
kB_read/s と kB_wrtn/s には 2 kB/s の違いがあることに気づくだろう。

.\"O This command is provided with an interval in seconds. However internally the interval is
.\"O tracked per device and can potentially have an effect on the per second statistics reported.
このコマンドは時間間隔を秒で指定する。
しかし内部的には時間間隔はデバイスごとに監視され、
レポートされる 1 秒ごとの統計に影響を及ぼす可能性がある。
.\"O The time each set of statistics is captured is kept with those statistics. The difference
.\"O between the current and previous time is converted to milliseconds for use in calculations.
各統計のセットがキャプチャされた時刻は、その統計値とともに保存される。
現在時刻と前の時刻の差分は、計算のためにミリ秒に変換される。
.\"O We can look at how this can impact the statistics reported if we use an example of a tar
.\"O archive being copied between two tape drives using dd. If both devices reported 28900 kilobytes
.\"O transferred and the reading tape drive had an interval of 5001 milliseconds and the writing
.\"O tape drive 5000 milliseconds that would calculate out as 5778 kB_read/s and 5780 kB_wrtn/s.
これが統計レポートにどのような影響があるかを、
tar アーカイブを dd を使って 2 つのテープドライブの間でコピーする例で見てみよう。
両方のデバイスが 28900 キロバイトを転送し、
テープドライブからの読み込みに 5001 ミリ秒かかり、
テープドライブへの書き込みに 5000 ミリ秒かかったとすると、
計算結果は 5778 kB_read/s と 5780 kB_wrtn/s になる。

.\"O The impact of some retrieving statistics during an I/O completion, rounding down, and small differences in the interval period on the statistics calculated should be minimal but may be non-zero.
I/O 完了時に取得した統計への影響は、統計値を計算する際の
切り捨てによる丸めと、時間間隔の小さな差分により、小さいが 0 ではない可能性がある。
.\"O .SH ENVIRONMENT
.SH 環境変数
.\"O The
.\"O .B tapestat
.\"O command takes into account the following environment variables:
.B tapestat
コマンドは以下の環境変数を扱う。

.IP S_COLORS
.\"O When this variable is set, display statistics in color on the terminal.
この環境変数を設定すると、端末上で統計をカラー表示する。
.\"O Possible values for this variable are
.\"O .IR never ,
.\"O .IR always
.\"O or
.\"O .IR auto
.\"O (the latter is the default).
この環境変数に指定可能な値は、
.IR never ,
.IR always ,
.I auto
である (最後がデフォルトである)。

.\"O Please note that the color (being red, yellow, or some other color) used to display a value
.\"O is not indicative of any kind of issue simply because of the color. It only indicates different
.\"O ranges of values.
値を表示する色 (赤、黄、またはその他の色) は、色によって何かの意味を示している訳ではない。
色は値の範囲を示しているだけである。

.IP S_COLORS_SGR
.\"O Specify the colors and other attributes used to display statistics on the terminal.
.\"O Its value is a colon-separated list of capabilities that defaults to
.\"O .BR H=31;1:I=32;22:M=35;1:N=34;1:Z=34;22 .
.\"O Supported capabilities are:
端末で統計を表示する際に、色とその他の属性を指定する。
この値は、コロン区切りの機能のリストで、デフォルトは
.B H=31;1:I=32;22:M=35;1:N=34;1:Z=34;22
である。
サポートされている機能は以下のとおり。

.RS
.TP
.B H=
.\"O SGR (Select Graphic Rendition) substring for percentage values greater than or equal to 75%.
割合が 75% 以上の場合の SGR (Select Graphic Rendition) 部分文字列。

.TP
.B I=
.\"O SGR substring for tape names.
テープ名を表示する SGR 部分文字列。

.TP
.B M=
.\"O SGR substring for percentage values in the range from 50% to 75%.
割合が 50% から 75% の場合の SGR 部分文字列。

.TP
.B N=
.\"O SGR substring for non-zero statistics values.
0 以外の統計値を表示する SGR 部分文字列。

.TP
.B Z=
.\"O SGR substring for zero values.
0 を表示する SGR 部分文字列。
.RE

.IP S_TIME_FORMAT
.\"O If this variable exists and its value is
.\"O .BR ISO
.\"O then the current locale will be ignored when printing the date in the report
.\"O header. The
.\"O .B tapestat
.\"O command will use the ISO 8601 format (YYYY-MM-DD) instead.
この環境変数が存在し、かつ値が
.B ISO
の場合、レポートのヘッダの日付を表示する際に、
現在のロケールを無視する。
代わりに、
.B tapestat
コマンドは ISO 8601 フォーマット (YYYY-MM-DD) を使う。
.\"O The timestamp displayed with option -t will also be compliant with ISO 8601
.\"O format.
-t オプションのタイムスタンプも ISO 8601 フォーマットに従う。

.\"O .SH BUGS
.SH バグ
.\"O .I /sys
.\"O filesystem must be mounted for
.\"O .B tapestat
.\"O to work. It will not work on kernels that do not have sysfs support
.B tapestat
コマンドが動作するためには、
.I /sys
ファイルシステムがマウントされていなければならない。
sysfs サポートがないカーネルでは動作しない。

.\"O This command requires kernel version 4.2 or later
.\"O (or tape statistics support backported for an earlier kernel version).
このコマンドはカーネル 4.2 以降が必要である
(もしくは、それ以前のカーネルに、テープの統計がバックポートされている
必要がある)。

.\"O .SH FILES
.SH ファイル
.I /sys/class/scsi_tape/st<num>/stats/*
.\"O Statistics files for tape devices.
テープデバイスの統計ファイル。

.I /proc/uptime
.\"O contains system uptime.
システムの uptime を保持する。
.\"O .SH AUTHOR
.SH 著者
.\"O Initial revision by Shane M. SEYMOUR (shane.seymour <at> hpe.com)
最初のリビジョンは Shane M. SEYMOUR (shane.seymour <at> hpe.com) が作成した。
.br
.\"O Modified for sysstat by Sebastien Godard (sysstat <at> orange.fr)
sysstat 用に Sebastien Godard (sysstat <at> orange.fr) が修正した。
.\"O .SH SEE ALSO
.SH 関連項目
.BR iostat (1),
.BR mpstat (1)

.I https://github.com/sysstat/sysstat

.I http://pagesperso-orange.fr/sebastien.godard/
