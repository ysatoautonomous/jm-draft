<HTML>
  <HEAD>
  <META CHARSET="UTF-8"/>
  <META HTTP-QUIV="Content-Type" CONTENT="text/html; charset=UTF-8"/>
  <LINK REL="stylesheet" TYPE="text/css"
	    HREF="../../../../css/jm-draft.css"/>
  <TITLE>Manpage of E2FSCK</TITLE>
</HEAD><BODY>
<H1>E2FSCK</H1>
Section: Maintenance Commands (8)<BR>Updated: February 2012<BR><A HREF="#index">Index</A>
<A HREF="https://github.com/ysatoautonomous/jm-draft/wiki">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>名前</H2>

e2fsck - Linux ext2/ext3/ext4 ファイルシステムをチェックする
<A NAME="lbAC">&nbsp;</A>
<H2>書式</H2>

<B>e2fsck</B> [ <B>-pacnyrdfkvtDFV</B> ] [ <B>-b</B> <I>superblock</I> ] [ <B>-B</B>
<I>blocksize</I> ] [ <B>-l|-L</B> <I>bad_blocks_file</I> ] [ <B>-C</B> <I>fd</I> ] [ <B>-j</B>
<I>external-journal</I> ] [ <B>-E</B> <I>extended_options</I> ] <I>device</I>
<A NAME="lbAD">&nbsp;</A>
<H2>説明</H2>

<B>e2fsck</B> は ext2/ext3/ext4 系のファイルシステムのチェックに使われる。ジャーナルを使っているファイルシステム ext3 と
ext4
の場合、システムがエラーはないが適切にシャットダウンされていなかった場合、通常は、ジャーナル内のコミット済みのトランザクションを再生した後は、そのファイルシステムには
clean
であるという印が付けられることになる。したがって、ジャーナルを使っているファイルシステムでは、スーパーブロックでさらなるチェックが必要とされていない限り、<B>e2fsck</B>
は通常ジャーナルの再生を行い、終了することになる。
<P>

<I>device</I> はファイルシステムが保存されているデバイスファイルである (例: <I>dev/hdc1</I>)。
<P>

マウントされているファイルシステムに対して <B>e2fsck</B> を実行するのは、一般的に言って、安全でないという点に注意すること。 唯一の例外は、
<B>-n</B> が指定されていて、かつ <B>-c</B>, <B>-l</B>, <B>-L</B> オプションが指定されて<I>いない</I>場合である。
しかし安全に実行できたとしても、 ファイルシステムがマウントされているときに <B>e2fsck</B> で表示される結果は有効ではない。
マウントされているファイルシステムをチェックすべきか否かを <B>e2fsck</B> が質問してきた場合、唯一の正しい答えは ``no'' である。
何をしているかを本当に分かっているエキスパートのみが、 この質問に対して別の答えを出すかを考えるべきである。
<A NAME="lbAE">&nbsp;</A>
<H2>オプション</H2>

<DL COMPACT>
<DT><B>-a</B><DD>
このオプションは <B>-p</B> オプションと同様のものとみなされる。 下位互換性のためにのみ準備されているオプションであるため、 できる限り <B>-p</B>
オプションを使うことが推奨される。
<DT><B>-b</B><I> superblock</I><DD>
通常のスーパーブロックのかわりに、 <I>superblock</I> をスーパーブロックとして利用する。 このオプションが用いられるのは、
プライマリなスーパーブロックが壊れた場合である。 バックアップスーパーブロックの場所は、 ファイルシステムのブロックサイズによって異なる。
ファイルシステムのブロックサイズが 1k の場合、 バックアップスーパーブロックは 8193 にある。 また、ブロックサイズが 2k の場合は
16384 に、 4k の場合は 32768 にある。
<DT><DD>
バックアップ用の追加スーパーブロックの位置を決めるには、 <B>mke2fs</B> プログラムを <B>-n</B> オプション付きで実行して、
スーパーブロックが生成された場所を表示させればよい。 スーパーブロックの正確な場所を表示させたければ、 <B>-b</B>
オプションでファイルシステムのブロックサイズを指定して <B>mke2fs</B> を実行しなければならない。
<DT><DD>
代替スーパーブロックが指定され、 ファイルシステムが read-only 以外で open されている場合、 e2fsck
はファイルシステムのチェックが終わったときに プライマリのスーパーブロックを適切な値に更新するかどうかの 確認を求める。
<DT><B>-B</B><I> blocksize</I><DD>
通常 <B>e2fsck</B> は、 適切なブロックサイズを探すために スーパーブロックを様々なブロックサイズでサーチする。
この作業は無駄な場合がある。このオプションは、 ブロックサイズを指定してスーパーブロックをサーチするよう指定する。 スーパーブロックが見つからない場合、
<B>e2fsck</B> は致命的なエラー (fatal error) で終了する。
<DT><B>-c</B><DD>
このオプションを指定すると、 <B>e2fsck</B> は <B><A HREF="../man8/badblocks.8.html">badblocks</A></B>(8)  を使ってデバイスの read-only
スキャンを行い、不良ブロックを探す。 不良ブロックが見つかると、それを不良ブロック inode に加え、 ファイルやディレクトリとして確保
(allocate) されないようにする。 このオプションが 2 つ指定されると、 不良ブロックのスキャンは非破壊的 read-write
テストを用いて行われる。
<DT><B>-C</B><I> fd</I><DD>
このオプションを指定すると、 <B>e2fsck</B>
は完了状況を指定されたファイルディスクリプタに書き込む。これにより、ファイルシステムチェックの進行状況を監視することができる。このオプションは通常
<B>e2fsck</B>
を走らせているプログラムが使用する。ファイルディスクリプタ番号が負の場合、ファイルディスクリプタの絶対値がディスクリプタ値として使用され、最初は進行状況の出力が行わない。後で
SIGUSR1 シグナルを <B>e2fsck</B> プロセスに送ることで出力を有効にできる。指定されたファイルディスクリプタが 0 の場合、
<B>e2fsck</B> は進行状況をプログレスバーで表示する。このためには、 <B>e2fsck</B> がビデオコンソールか端末で実行されている必要がある。
<DT><B>-d</B><DD>
デバッグ情報を出力する (<B>e2fsck</B> をデバッグするときにしか役に立たない)。
<DT><B>-D</B><DD>
ファイルシステム中のディレクトリを最適化する。 このオプションが指定された場合、 e2fsck はすべてのディレクトリの最適化を行おうとする。
ファイルシステムがディレクトリインデクシングをサポートしている場合には、 インデックスを再生成することで、 最適化を行う。
従来の線形的なディレクトリ構造を使うファイルシステムでは、 小さなディレクトリから順にソートして圧縮することで、 最適化を行う。
<DT><DD>
<B>-D</B> オプションが指定されていない場合でも、 <B>e2fsck</B> は時にはいくつかのディレクトリの最適化を行うことがある。 --- 例えば、
ディレクトリインデクシングが有効になっていて、
ディレクトリのインデックスが作成されておらず、インデックスを作成した方がよい場合や、インデックス構造が壊れていて作成し直す必要がある場合、などである。
<B>-D</B>
オプションを指定した場合、そのファイルシステムのすべてのディレクトリの最適化が行われる。その結果、場合によっては、少しサイズが小さくなったり、検索が早くなることがあるが、実際には、このオプションを使う必要がある場面はめったにないだろう。
<DT><DD>
<B>-D</B> オプションを指定すると、1 つのディレクトリ内の重複した名前のディレクトリエントリを検出する。通常 e2fsck
は、性能上の理由からこの検出を行わない。
<DT><B>-E</B><I> extended_options</I><DD>
e2fsck に拡張オプションを設定する。 拡張オプション間はコンマで区切り、 等号 ('=') に続ける形で引数を取ることもできる。
次のオプションがサポートされている。
<DL COMPACT><DT><DD>
<DL COMPACT>
<DT><B>ea_ver=</B><I>extended_attribute_version</I><DD>
<B>e2fsck</B> がファイルシステムをチェックする際に必要な、拡張属性ブロックのバージョンを指定する。バージョン番号は 1 または 2
である。デフォルトの拡張属性バージョンフォーマットは 2 である。
<DT><B>journal_only</B><DD>
必要な場合にジャーナルの再生のみを行う。チェックや修復は行わない。
<DT><B>fragcheck</B><DD>
pass 1 で、ファイルシステムのファイルに不連続なブロックがある場合に、詳細なレポートを表示する。
<DT><B>discard</B><DD>
ファイルシステムチェックが完了した後に、空きブロックと未使用 inode を破棄する (ブロックの破棄は、ソリッドステートデバイスとスパース
(sparse) /
シンプロビジョニングされたストレージでは有益である)。破棄は、ファイルシステムの完全なチェックが行われ、かつ認識されたエラーがない場合にのみ、pass
5 で行われる。しかし、<B>e2fsck</B> が問題を認識できないケースでは、このオプションを使うと手動でのデータ修復ができなくなる。
<DT><B>nodiscard</B><DD>
空きブロックと未使用 inode ブロックを破棄しない。このオプションは discard オプションと正反対である。これがデフォルトで設定されている。
</DL>
</DL>

<DT><B>-f</B><DD>
ファイルシステムが clean な場合でも、強制的にチェックする。
<DT><B>-F</B><DD>
チェックを始める前に、ファイルシステムデバイスのキャッシュバッファを フラッシュする。 <B>e2fsck</B> を用いたタイムトライアルにのみ有用。
<DT><B>-j</B><I> external-journal</I><DD>
このファイルシステムの外部ジャーナルがあるパス名を設定する。
<DT><B>-k</B><DD>
<B>-c</B> オプションと組み合わせると、 不良ブロックリストにある既存の不良ブロックは保存され、 <B><A HREF="../man8/badblocks.8.html">badblocks</A></B>(8)
を実行して見つかった新たな不良ブロックが 既存の不良ブロックリストに追加される。
<DT><B>-l</B><I> filename</I><DD>
<I>filename</I> で指定したファイルにリストされているブロック番号を 不良ブロックのリストに追加する。このファイルのフォーマットは
<B><A HREF="../man8/badblocks.8.html">badblocks</A></B>(8)  プログラムが出力するものと同じである。 ブロック番号はファイルシステムのブロックサイズに基づいていることに注意。
したがって正しい結果を得るためには <B><A HREF="../man8/badblocks.8.html">badblocks</A></B>(8)  にファイルシステムのブロックサイズを与えなければならない。 よって、
<B>e2fsck</B> に <B>-c</B> オプションを与える方が、ずっと単純かつ安全である。 このオプションを指定すれば、正しいパラメータが
<B>badblocks</B> プログラムに渡ることになっている。
<DT><B>-L</B><I> filename</I><DD>
<I>filename</I> で指定したファイルに書かれているブロックリストを、 不良ブロックのリストに指定する。 (このオプションは <B>-l</B>
オプションとは異なり、ファイルにリストされているブロックを 不良ブロックリストに加える前に、 不良ブロックリストをいったんクリアする。)
<DT><B>-n</B><DD>
ファイルシステムを read-only で open し、全ての問いに対して「no」と答える。 <B>e2fsck</B> を非対話的に動作させることができる。
このオプションは <B>-p</B> または <B>-y</B> オプションと同時に指定してはならない。
<DT><B>-p</B><DD>
ファイルシステムを質問なしで自動的に修復 (preen) する。 このオプションを指定すると、 <B>e2fsck</B>
は安全に修正できるファイルシステムの問題を、 使用者と対話せずに自動的に修正する。 <B>e2fsck</B>
は、システム管理者が別に正しい行動をとる必要のある問題を見つけると、 問題の説明を表示し、値 4 と返り値の論理 OR をとった値で終了する。
(「<B>返り値</B>」のセクションを参照すること。)  通常、このオプションはシステムのブートスクリプトで使われる。 このオプションは <B>-n</B> または
<B>-y</B> オプションと同時に指定してはならない。
<DT><B>-r</B><DD>
このオプションは何もしない。 過去との互換性のために準備されているだけである。
<DT><B>-t</B><DD>
<B>e2fsck</B> のタイミング統計 (statistics) を表示する。 このオプションを 2 つ指定すると、より詳細なタイミング統計が
次々と得られる。
<DT><B>-v</B><DD>
詳細な表示をする。
<DT><B>-V</B><DD>
バージョン情報を表示して終了する。
<DT><B>-y</B><DD>
全ての問いに対して「yes」と答える。これによって <B>e2fsck</B> を非対話的に動作させることができる。 このオプションは <B>-n</B> または
<B>-p</B> オプションと同時に指定してはならない。
</DL>
<A NAME="lbAF">&nbsp;</A>
<H2>返り値</H2>

<B>e2fsck</B> の返り値は、以下の状態を表す数の和になる。
<BR>

	0	-&nbsp;エラーなし
<BR>

	1	-&nbsp;ファイルシステムのエラーが修正された
<BR>

	2	-&nbsp;ファイルシステムのエラーが修正された。
<BR>

		&nbsp;&nbsp;システムをリブートしなければならない
<BR>

	4	-&nbsp;ファイルシステムのエラーが修正されないまま残っている
<BR>

	8	-&nbsp;操作エラー
<BR>

	16	-&nbsp;利用法・文法のエラー
<BR>

	32	-&nbsp;e2fsck がユーザ要求によってキャンセルされた
<BR>

	128	-&nbsp;共有ライブラリのエラー
<BR>

<A NAME="lbAG">&nbsp;</A>
<H2>シグナル</H2>

以下のシグナルが <B>e2fsck</B> に送られると、記述されているような効果を及ぼす。
<DL COMPACT>
<DT><B>SIGUSR1</B><DD>
このシグナルを受けると <B>e2fsck</B> はプログレスバーを表示し、進捗情報を表示する。(<B>-C</B> オプションの説明を参照。)
<DT><B>SIGUSR2</B><DD>
このシグナルを受けると、<B>e2fsck</B> はプログレスバーの表示と、進捗情報の表示をやめる。
</DL>
<A NAME="lbAH">&nbsp;</A>
<H2>バグ報告</H2>

どんなソフトウェアにもバグはつきものである。 もしも <B>e2fsck</B> がクラッシュしたり、 <B>e2fsck</B>
によって修復できない事態が発生したりした場合は、 作者に連絡してほしい。
<P>

バグ報告にはできるだけ多くの情報を入れてほしい。 <B>e2fsck</B> の完全な実行記録があれば、
私はどのようなエラーが発生しているかを確認することができる。 (<B>e2fsck</B> で表示されるメッセージが英語であることを確認してほしい。
<B>e2fsck</B> のメッセージが他の言語に翻訳されるようにシステムが設定されている場合は、 環境変数 <B>LC_ALL</B> を <B>C</B>
に設定して、e2fsck の出力の実行記録が私にとって役立つようにしてほしい。)  実行記録を書き込むことのできるファイルシステムがあるなら、
<B><A HREF="../man1/script.1.html">script</A></B>(1)  プログラムを用いれば、簡単に <B>e2fsck</B> の出力を保存できる。
<P>

<B><A HREF="../man8/dumpe2fs.8.html">dumpe2fs</A></B>(8)  の出力も役に立つ。 特定の inode の不良が <B>e2fsck</B> の動作をおかしくしているようなら、
<B><A HREF="../man8/debugfs.8.html">debugfs</A></B>(8)  コマンドを起動し、該当する inode に対して <I>stat</I> コマンドを実行して、その出力を送ってほしい。 その
inode がディレクトリである場合は、debugfs の <I>dump</I> コマンドを利用すれば、ディレクトリ inode
の内容を取り出すことができる。 その内容を <B><A HREF="../man1/uuencode.1.html">uuencode</A></B>(1)  にかければ、そのまま私に報告することができる。
バグを再現するためにユーザが送ることのできる最も有用なデータは、 <B><A HREF="../man8/e2image.8.html">e2image</A></B>(8)  を使って生成されるファイルシステムの圧縮された raw
イメージダンプである。 より詳細な情報は <B><A HREF="../man8/e2image.8.html">e2image</A></B>(8)  を参照すること。
<P>

私に報告する際には、どのバージョンなのか私にわかるよう、 <B>e2fsck</B> の実行時に表示されるバージョン文字列を必ず入れてほしい。
<A NAME="lbAI">&nbsp;</A>
<H2>作者</H2>

このバージョンの <B>e2fsck</B> は Theodore Ts'o &lt;<A HREF="mailto:tytso@mit.edu">tytso@mit.edu</A>&gt; が作成した。
<A NAME="lbAJ">&nbsp;</A>
<H2>関連項目</H2>

<B><A HREF="../man5/e2fsck.conf.5.html">e2fsck.conf</A></B>(5), <B><A HREF="../man8/badblocks.8.html">badblocks</A></B>(8), <B><A HREF="../man8/dumpe2fs.8.html">dumpe2fs</A></B>(8), <B><A HREF="../man8/debugfs.8.html">debugfs</A></B>(8),
<B><A HREF="../man8/e2image.8.html">e2image</A></B>(8), <B><A HREF="../man8/mke2fs.8.html">mke2fs</A></B>(8), <B><A HREF="../man8/tune2fs.8.html">tune2fs</A></B>(8)
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">名前</A><DD>
<DT><A HREF="#lbAC">書式</A><DD>
<DT><A HREF="#lbAD">説明</A><DD>
<DT><A HREF="#lbAE">オプション</A><DD>
<DT><A HREF="#lbAF">返り値</A><DD>
<DT><A HREF="#lbAG">シグナル</A><DD>
<DT><A HREF="#lbAH">バグ報告</A><DD>
<DT><A HREF="#lbAI">作者</A><DD>
<DT><A HREF="#lbAJ">関連項目</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 18:50:56 GMT, March 26, 2020
</BODY>
</HTML>
