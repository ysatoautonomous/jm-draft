<HTML>
  <HEAD>
  <META CHARSET="UTF-8"/>
  <META HTTP-QUIV="Content-Type" CONTENT="text/html; charset=UTF-8"/>
  <LINK REL="stylesheet" TYPE="text/css"
	    HREF="../../../../css/jm-draft.css"/>
  <TITLE>Manpage of FSCK</TITLE>
</HEAD><BODY>
<H1>FSCK</H1>
Section: System Administration (8)<BR>Updated: February 2009<BR><A HREF="#index">Index</A>
<A HREF="https://github.com/ysatoautonomous/jm-draft/wiki">Return to Main Contents</A><HR>


<A NAME="lbAB">&nbsp;</A>
<H2>名前</H2>


fsck - Linux ファイルシステムのチェックと修復を行う

<A NAME="lbAC">&nbsp;</A>
<H2>書式</H2>

<B>fsck</B>

[<B>-lsAVRTMNP</B>]

[<B>-r</B>

[<I>fd</I>]]

[<B>-C</B>

[<I>fd</I>]]

[<B>-t</B>

<I>fstype</I>]

[<I>filesystem</I>...]

[<B>--</B>]

[<I>fs-specific-options</I>]


<A NAME="lbAD">&nbsp;</A>
<H2>説明</H2>



<B>fsck</B>

は (ひとつまたは複数の) Linux ファイルシステムをチェックし、また指定すれば修復も行う。 







<I>filesys</I>

に指定できるのは、デバイス名 (例:
<I>/dev/hdc1</I>, <I>/dev/sdb2</I>)、

マウントポイント (例:
<I>/</I>, <I>/usr</I>, <I>/home</I>)、

ファイルシステムラベルまたは UUID 指定 (例:
UUID=8868abf6-88c5-4a83-98b8-bfc24057f7bd または LABEL=root) である。




通常
<B>fsck</B>

は、物理的に異なるディスク上にある複数のファイルシステムを並列的に
チェックし、全ファイルシステムのチェックに要する時間を短縮しようとする。
<P>










コマンドラインからファイルシステムがひとつも指定されず、
かつ
<B>-A</B>

オプションも指定されなかった場合は、
<B>fsck</B>

はデフォルトの動作として
<I>/etc/fstab</I>

に書かれているファイルシステムを逐次的にチェックする。
これは
<B>-As</B>

オプションを指定した場合の動作と同じである。
<P>




<B>fsck</B>

の返り値は、以下の状態を表す数の和となる:
<P>

<DL COMPACT><DT><DD>

<DL COMPACT>
<DT><B>0</B>

<DD>

エラーなし
<DT><B>1</B>

<DD>

ファイルシステムのエラーが修正された
<DT><B>2</B>

<DD>

システムをリブートする必要がある
<DT><B>4</B>

<DD>

ファイルシステムのエラーが修正されないまま残っている
<DT><B>8</B>

<DD>

操作エラー
<DT><B>16</B>

<DD>

利用法・文法のエラー
<DT><B>32</B>

<DD>

fsck がユーザ要求によってキャンセルされた
<DT><B>128</B>

<DD>

共有ライブラリのエラー

</DL>
</DL>

<P>




複数のファイルシステムをチェックした場合の返り値は、
チェックした各ファイルシステムの返り値に対して、
ビットごとの OR をとったものになる。
<P>








<B>fsck</B>

は、実際には Linux で利用できるさまざまなファイルシステムチェッカー
(<B>fsck</B>.<I>fstype</I>) への単なるフロントエンドにすぎない。
ファイルシステム固有のチェッカーは、環境変数 PATH 内で探される。
PATH が定義されていない場合、&quot;/sbin&quot; 内で探す。
<P>



詳細はファイルシステム固有のチェッカーのマニュアルを参照すること。

<A NAME="lbAE">&nbsp;</A>
<H2>オプション</H2>

<DL COMPACT>
<DT><B>-l</B>

<DD>



ディスクデバイス全体に対して、排他
<B><A HREF="../man2/flock.2.html">flock</A></B>(2)

ロックファイル (/run/fsck/&lt;diskname&gt;.lock) を作成する。







このオプションは 1 つのデバイスのみに使える
(つまり、<B>-A</B> と <B>-l</B> は同時に指定できない)。
このオプションは、複数の
<B><A HREF="../man8/fsck.8.html">fsck</A></B>(8)

インスタンスが同時に実行される場合に推奨される。
このオプションは、複合デバイスや非回転ディスクでは無視される。
<B>fsck</B> はスタックデバイス (例えば MD または DM) のチェックをする場合には、
下層のデバイスをロックしない - この機能は、まだ実装されていない。
<DT><B>-r</B>&nbsp;[<B></B><I>fd</I>]

<DD>




各 fsck が完了した際に、ある程度の統計情報を表示する。
この統計情報には、返り値、(キロバイト単位の) 最大実行セットサイズ (run set size)、
fsck の実行に使われた全ての経過クロック時間、ユーザー CPU 時間、システム CPU 時間が含まれる。
例:
<P>
/dev/sda1: status 0, rss 92828, real 4.002804, user 2.677592, sys 0.86186
<P>




GUI フロントエンドにはファイルディスクリプタ
<I>fd</I>

指定することができる。
この場合、棒グラフの情報は、マシンが解析しやすい形式で、ファイル
ディスクリプタに送られる。
例:
<P>
/dev/sda1 0 92828 4.002804 2.677592 0.86186
<DT><B>-s</B>

<DD>














<B>fsck</B>

の動作を逐次的にする。
複数のファイルシステムをインタラクティブ (対話) モードでチェックする際に有用。
(注意: デフォルトでは
<B><A HREF="../man8/e2fsck.8.html">e2fsck</A></B>(8)

の動作は対話モードである。
<B><A HREF="../man8/e2fsck.8.html">e2fsck</A></B>(8)

を非対話モードで動作させるには、
<B>-p</B>

オプションか
<B>-a</B>

オプションを使用する。
また非対話的にエラーを自動修復させたい場合は
<B>-n</B>

オプションを利用する。)
<DT><B>-t</B><I> fslist</I>

<DD>


















チェックするファイルシステムのタイプを指定する。
<B>-A</B>

オプションが指定されている場合は、
<I>fslist</I>

にマッチするファイルシステムのみをチェックする。
<I>fslist</I>

パラメータは、コンマで区切られたファイルシステムとオプション指定の
リストである。
このコンマ区切りのリストに含まれるファイルシステムのすべてに、
否定演算子
'<B>no</B>'

または
'<B>!</B>',

を前置することもできる。
これにより、
<I>fslist</I>

にリストされていないファイルシステムだけがチェックされる。
<I>fslist</I>

のファイルシステムすべてに否定演算子が付けられていない場合は、
<I>fslist</I>
にリストされているファイルシステムのみがチェックされる。
(訳註: リストの一部だけに否定演算子を付けることはできない)
<P>















オプション指定をコンマで区切った形で
<I>fslist</I>

に含めても良い。
これらは
<B>opts=</B><I>fs-option</I>

という書式でなければならない。
オプション指定が存在すると、
<I>/etc/fstab</I>

のマウントオプションのフィールドに
<I>fs-option</I>

があるファイルシステムのみがチェックされる。
オプション指定の前に否定演算子がある場合は、
<I>/etc/fstab</I>

のマウントオプションのフィールドに
<I>fs-option</I>

がないファイルシステムのみがチェックされる。
<P>









例えば、
<B>opts=ro</B>

を
<I>fslist</I>

に指定すると、
<I>/etc/fstab</I>

にリストされているファイルシステムのうち、
<B>ro</B>

オプションを持つものだけがチェックされる。
<P>












<B>fsck</B>

プログラムへの非公式なユーザインターフェース変更に依存した
ブートスクリプトを使っている Mandrake ディストリビューションとの互換性のため、
<I>fslist</I>

にファイルシステムタイプ
<B>loop</B>

があった場合、
<B>-t</B>

オプションの引き数として
<B>opts=loop</B>

が指定されていると仮定する。
<P>





通常ファイルシステムのタイプは、
<I>filesys</I>

を
<I>/etc/fstab</I>

ファイルから検索して見つかったエントリから取得する。







ファイルシステムのタイプが取得できず、かつ 1 つのファイルシステムだけが
<B>-t</B>

オプションの引き数になっている場合、
<B>fsck</B>

はそれを利用する。
指定してあるファイルシステムタイプを利用できない場合は、
デフォルトのファイルシステムタイプ (現時点では ext2) を利用する。
<DT><B>-A</B>

<DD>







<I>/etc/fstab</I>

に列記されているファイルシステムをすべてチェックする。
このオプションを用いれば、複数のファイルシステムに対して fsck　をひとつひとつ
単独で実行しなくてもよいため、システムの初期設定ファイルである
<I>/etc/rc</I>

中でよく利用される。
<P>








<B>-P</B>

オプション (後述) が指定されていなければ、ルートファイルシステムが最初にチェック
される。
その後、
<I>/etc/fstab</I>

ファイルの第 6 フィールドである
<I>fs_passno</I>

の順序にしたがって他のファイルシステムがチェックされる。












<I>fs_passno</I>

の値が 0 であるファイルシステムは、スキップされて一切チェックされない。
<I>fs_passno</I>

の値が 0 より大きいファイルシステムは、小さい
<I>fs_passno</I>
値を持ったものを優先し、順番にチェックされる。
同じ番号が指定されているファイルシステムが複数ある場合には、
<B>fsck</B>

はそれらを並列してチェックしようとする。
しかし同じ物理ディスクにあるファイルシステムの同時チェックは避ける。
<P>




<B>fsck</B>

はスタックデバイス (RAID, dm-crypt, ...) を他のデバイスと並列してチェックしない。
以下の FSCK_FORCE_ALL_PARALLEL の設定を参照すること。
/sys ファイルシステムを使って、デバイス間の依存関係を決定する。
<P>















したがって、
<I>/etc/fstab</I>

に対する最も普通の設定は、ルートファイルシステムの
<I>fs_passno</I>

を 1 とし、他のすべてのファイルシステムの
<I>fs_passno</I>

を 2 とするものである。
こうすると
<B>fsck</B>

は、(効果が期待できる場合には)
自動的にファイルシステムチェッカーを同時に並列して動作させる。
何らかの理由で複数ファイルシステムの並列チェックをしたくない
場合には、システム管理者はこの設定をしてはいけない。
たとえばマシンのメモリが少なく、余分なページングが問題になる場合
などがこれにあたる。
<P>











<B>fsck</B>

はファイルシステム固有のチェッカーを呼ぶ前に、デバイスが実際に
存在するかを確認しない。
よって、ブート中にファイルシステム固有のチェッカーが致命的な
エラーを返した場合、
デバイスが存在しないと、システムがファイルシステムの修復モードに
入ってしまう。
<I>/etc/fstab</I>

のマウントオプション
<B>nofail</B>

は、存在しないデバイスを
<B>fsck</B>

にスキップさせるために使われる。



<B>fsck</B>

は、特別なファイルシステムタイプ
<B>auto</B>

が指定されているデバイスが存在しない場合にも、スキップする。
<DT><B>-C</B>&nbsp;[<B></B><I>fd</I>]

<DD>






作業完了分・残り分の棒グラフをサポートしているファイルシステム
チェッカー (現在 ext2,3,4 用のものだけ) に、表示を行わせる。
<B>fsck</B> は一度にひとつのチェッカーだけが表示を行うように、複数の
チェッカーを管理する。
GUI フロントエンドにはファイルディスクリプタ
<I>fd</I>

を指定することができる。
この場合、棒グラフの情報はファイルディスクリプタに送られる。
<DT><B>-M</B>

<DD>


マウントされているファイルシステムはチェックしない。
その場合、終了コード 0 を返す。
<DT><B>-N</B>

<DD>

実際には実行せず、何が行われるかだけを表示する。
<DT><B>-P</B>

<DD>









<B>-A</B>

オプションが指定されている場合、ルートファイルシステムを他の
ファイルシステムと並列にチェックする。
ルートファイルシステムが壊れている場合には
<B><A HREF="../man8/e2fsck.8.html">e2fsck</A></B>(8)

自体が壊れている可能性もあるため、
このオプションを用いるのは安全性を損なうことになる。
このオプションは、ルートファイルシステムを小さくコンパクトな
パーティションに切りなおしたくないシステム管理者向けのオプション
である
(ルートファイルシステムを小さくコンパクトにまとめるのが正しい
解なのだが)。
<DT><B>-R</B>

<DD>




<B>-A</B>

オプションを用いて全てのファイルシステムをチェックする際に、
ルートファイルシステムをチェックしないようにする
(ルートファイルシステムがすでに read/write でマウントされている場合)。
<DT><B>-T</B>

<DD>

起動時にタイトルを表示しない。
<DT><B>-V</B>

<DD>


<B>fsck</B> から起動されるシステム固有のコマンドを含め、詳細な表示をする。
<DT><B>-?</B>, <B>--help</B><DD>

ヘルプを表示して、終了する。
<DT><B>--version</B><DD>

バージョン情報を表示して、終了する。

</DL>
<A NAME="lbAF">&nbsp;</A>
<H2>ファイルシステム固有のオプション</H2>


<B>fsck が理解しないオプションは、ファイルシステム固有のチェッカーに渡される。</B>

<P>








これらのオプションは引き数をとっては<B>ならない</B>。
なぜなら、どのオプションが引き数をとるか (とらないか) を
<B>fsck</B>

が正しく判断できる方法がないためである。
<P>





<B>--</B>

以降に指定したオプションと引き数は、ファイルシステム固有のオプション
として、ファイルシステム固有のチェッカーに渡される。
<P>












<B>fsck</B>

は任意の複雑なオプションをファイルシステム固有のチェッカーに渡すようには
設計されていない点に注意すること。
複雑なことをやろうとするときは、ファイルシステム固有のチェッカーを直接
実行してほしい。
非常に複雑なオプションと引き数を
<B>fsck</B>

に渡した場合に、期待した動作をしなかったとしても、
<B>バグとして報告するには及ばない</B>。

<B>fsck</B>

にやらせるべきではないことを、あなたがやったのだから。

ファイルシステム固有の fsck のオプションは、標準化されていない。

<A NAME="lbAG">&nbsp;</A>
<H2>ファイル</H2>

<I>/etc/fstab</I>


<A NAME="lbAH">&nbsp;</A>
<H2>環境変数</H2>




<B>fsck</B>

プログラムの振舞いは、以下の環境変数による影響を受ける。
<DL COMPACT>
<DT><B>FSCK_FORCE_ALL_PARALLEL</B>

<DD>






この環境変数が設定されていると、
<B>fsck</B>

は指定されたファイルシステムすべてを、それらのファイルシステムが
同じデバイス上にあるように見えるかどうかを問わず、
並列にチェックしようとする。
(これは IBM や EMC などの会社から販売されているような、
RAID システムやハイエンドのストレージシステムで有用である。)
fs_passno の値が使われる点に注意すること。
<DT><B>FSCK_MAX_INST</B>

<DD>











この環境変数は、同時に動作するファイルシステムチェッカーの最大数を
制限する。
この指定を行えば、多数のディスクを備えたシステムにおいて
<B>fsck</B>

がたくさんのファイルシステムチェッカーを同時に起動し、
システムで利用できる CPU やメモリなどの資源に
過度の負荷を与えてしまうことを避けることができる。
この値を 0 にすると、spawn するプロセス数の制限がなくなる。
現在はこれがデフォルトだが、
<B>fsck</B>

の将来の版では、OS からアカウンティングデータを取得することにより、
同時に行うファイルシステムチェックの数を自動的に決めるようになる
かもしれない。
<DT><B>PATH</B>

<DD>



<B>PATH</B>

環境変数はファイルシステムチェッカーを探索する際に用いられる。 
<DT><B>FSTAB_FILE</B>

<DD>





この環境変数を用いると、システム管理者は
<I>/etc/fstab</I>

ファイルの標準的な置場所を変更できる。
これは
<B>fsck</B>

のテストを行う開発者にとっても便利である。
<DT><B>LIBBLKID_DEBUG=all</B>

<DD>

libblkid のデバッグ出力を有効にする。
<DT><B>LIBMOUNT_DEBUG=all</B>

<DD>

libmount のデバッグ出力を有効にする。

</DL>
<A NAME="lbAI">&nbsp;</A>
<H2>関連項目</H2>


<B><A HREF="../man5/fstab.5.html">fstab</A></B>(5),

<B><A HREF="../man8/mkfs.8.html">mkfs</A></B>(8),

<B><A HREF="../man8/fsck.ext2.8.html">fsck.ext2</A></B>(8)


または
<B><A HREF="../man8/fsck.ext3.8.html">fsck.ext3</A></B>(8)


または
<B><A HREF="../man8/e2fsck.8.html">e2fsck</A></B>(8),

<B><A HREF="../man8/cramfsck.8.html">cramfsck</A></B>(8),

<B><A HREF="../man8/fsck.jfs.8.html">fsck.jfs</A></B>(8),

<B><A HREF="../man8/fsck.nfs.8.html">fsck.nfs</A></B>(8),

<B><A HREF="../man8/fsck.minix.8.html">fsck.minix</A></B>(8),

<B><A HREF="../man8/fsck.msdos.8.html">fsck.msdos</A></B>(8),

<B><A HREF="../man8/fsck.vfat.8.html">fsck.vfat</A></B>(8),

<B><A HREF="../man8/fsck.xfs.8.html">fsck.xfs</A></B>(8),

<B><A HREF="../man8/reiserfsck.8.html">reiserfsck</A></B>(8)



<A NAME="lbAJ">&nbsp;</A>
<H2>著者</H2>

<PRE>
Theodore Ts'o &lt;<A HREF="mailto:tytso@mit.edu">tytso@mit.edu</A>&gt;
Karel Zak &lt;<A HREF="mailto:kzak@redhat.com">kzak@redhat.com</A>&gt;
</PRE>


<A NAME="lbAK">&nbsp;</A>
<H2>入手方法</H2>





fsck コマンドは util-linux パッケージの一部であり、

Linux Kernel Archive

から入手できる。
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">名前</A><DD>
<DT><A HREF="#lbAC">書式</A><DD>
<DT><A HREF="#lbAD">説明</A><DD>
<DT><A HREF="#lbAE">オプション</A><DD>
<DT><A HREF="#lbAF">ファイルシステム固有のオプション</A><DD>
<DT><A HREF="#lbAG">ファイル</A><DD>
<DT><A HREF="#lbAH">環境変数</A><DD>
<DT><A HREF="#lbAI">関連項目</A><DD>
<DT><A HREF="#lbAJ">著者</A><DD>
<DT><A HREF="#lbAK">入手方法</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 11:01:08 GMT, April 21, 2020
</BODY>
</HTML>
