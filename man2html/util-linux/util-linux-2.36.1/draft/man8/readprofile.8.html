<HTML>
  <HEAD>
  <META CHARSET="UTF-8"/>
  <META HTTP-QUIV="Content-Type" CONTENT="text/html; charset=UTF-8"/>
  <LINK REL="stylesheet" TYPE="text/css"
	    HREF="../../../../css/jm-draft.css"/>
  <TITLE>Manpage of READPROFILE</TITLE>
</HEAD><BODY>
<H1>READPROFILE</H1>
Section: System Administration (8)<BR>Updated: October 2011<BR><A HREF="#index">Index</A>
<A HREF="https://github.com/ysatoautonomous/jm-draft/wiki">Return to Main Contents</A><HR>


<A NAME="lbAB">&nbsp;</A>
<H2>名前</H2>


readprofile - カーネルのプロファイル情報を読み込む。

<A NAME="lbAC">&nbsp;</A>
<H2>書式</H2>

<B>readprofile</B>

[options]

<A NAME="lbAD">&nbsp;</A>
<H2>バージョン</H2>


この man ページはプログラムのバージョン 2.0 についてドキュメント化している。

<A NAME="lbAE">&nbsp;</A>
<H2>説明</H2>












<B>readprofile</B>

コマンドは
<I>/proc/profile</I>

の情報を使い、ASCII データを標準出力に表示する。
出力は 3 列から構成される。
1 列目はクロックティック (clock ticks) 数、
2 列目はそのティックス数が発生したカーネルの C 言語の関数名、
3 列目はプロシージャの正規化した「負荷」の値であり、
ティックス数とプロシージャの長さの割合である。
出力は、読みやすいように、空白で埋められる。

<A NAME="lbAF">&nbsp;</A>
<H2>オプション</H2>

<DL COMPACT>
<DT><B>-a</B>, <B>--all</B><DD>


マップファイル内の全てのシンボルを表示する。
デフォルトでは、レポートされるティックスのプロシージャは
表示されない。
<DT><B>-b</B>, <B>--histbin</B><DD>

各ヒストグラムの区間のカウントを表示する。
<DT><B>-i</B>, <B>--info</B><DD>










情報。
このオプションを指定すると、
<B>readprofile</B>

はカーネルによって使われるプロファイリングステップのみを表示する。
プロファイリングステップは、プロファイリングバッファの精度であり、
(`make config' による) カーネル設定、またはカーネルのコマンドラインで選択される。
<B>-t</B>

(terse: 簡略) スイッチが
<B>-i</B>

とともに使われた場合、10 進数の値のみが表示される。
<DT><B>-m</B>, <B>--mapfile</B> <I>mapfile</I><DD>






マップファイルを指定する。
デフォルトは
<I>/usr/src/linux/System.map</I>

である。
現在のカーネルが最後にコンパイルしたものでない場合、
または System.map をどこか他の場所に置いている場合、
マップファイルをコマンドラインで指定すべきである。
マップファイル名が `.gz' で終わっている場合、自動で展開される。
<DT><B>-M</B>, <B>--multiplier</B> <I>multiplier</I><DD>






アーキテクチャによっては、カーネルが各 CPU で行うプロファイリング割り込みの
周期を変更することができる。
このオプションでは、割り込みの周期を、システムクロックの周波数の
倍数に設定できる (HZ)。
Linux 2.6.16 では多くのシステムで倍数のサポートをなくした。
このオプションはプロファイリングバッファのリセットも行い、
スーパーユーザー権限が必要である。
<DT><B>-p</B>, <B>--profile</B> <I>pro-file</I><DD>









別のプロファイリングバッファを指定する。
デフォルトは
<I>/proc/profile</I>

である。
別の pro-file を使うのは、ある時点のカーネルプロファイリングを「凍結して (freeze)」、
後から読み込むのに役立つ。
ファイル
<I>/proc/profile</I>

は `cat' や `cp' を使ってコピーできる。
<B>readprofile-1.1</B>

にあった圧縮したプロファイリングバッファは、このプログラムが
バッファサイズを前もって知る必要があるため、もはやサポート
されてない。
<DT><B>-r</B>, <B>--reset</B><DD>




プロファイリングバッファをリセットする。
<I>/proc/profile</I>

は誰でも読み出し可能であるが、スーパーユーザーのみが書き込み
可能であるので、このオプションは root によってのみ呼び出し可能である。



しかし、
<B>readprofile</B>

を set-user-ID 0 にすれば、特権を得ずにバッファをリセットできる。
<DT><B>-s, --counters</B><DD>

関数内の各カウンタを表示する。
<DT><B>-v</B>, <B>--verbose</B><DD>




詳細な表示を行う。
出力は 4 つのカラムから構成され、空白で埋められる。
1 列目はカーネル関数の RAM アドレス、2 列目は関数名、
3 列目はクロックティック数、4 列目は正規化した負荷である。
<DT><B>-V</B>, <B>--version</B><DD>

バージョン番号を表示して、終了する。
<DT><B>-h</B>, <B>--help</B><DD>

ヘルプを表示して、終了する。

</DL>
<A NAME="lbAG">&nbsp;</A>
<H2>ファイル</H2>

<PRE>
/proc/profile              プロファイリングバッファのバイナリスナップショット
/usr/src/linux/System.map  カーネルのシンボルテーブル
/usr/src/linux/*           プロファイリング対象のプログラム :-)
</PRE>


<A NAME="lbAH">&nbsp;</A>
<H2>バグ</H2>

<P>





<I>/proc/profile</I>

はカーネル 1.2 から 1.3 の段階で変更されたので、
<B>readprofile</B>

は 1.3.x より新しいカーネルでしか動作しない。
<P>



このプログラムは ELF カーネルでしか動作しない。
a.out カーネルでの変更は取るに足らないものであるので、
a.out のユーザーへの練習として残してある。
<P>






プロファイリングを有効にするには、カーネルを再起動しなければならない。
なぜなら、プロファイリングモジュールは存在せず、簡単にはビルドできない
からである。
プロファイリングを有効にするには、カーネルのコマンドラインで
&quot;profile=2&quot; (または他の数値) を指定すればよい。
この数値は 2 のべき乗になり、プロファイリングのステップで使われる。
<P>




割り込みが禁止されているときには、プロファイリングは無効化される。
割り込みが再度有効化されたときに、多くのプロファイリングのティックスが
発生する。
誤解を生みやすい情報に注意すること。

<A NAME="lbAI">&nbsp;</A>
<H2>例</H2>


プロファイリングバッファをクロックティックの順に並べて見る:
<PRE>
   readprofile | sort -nr | less

</PRE>


負荷の高い順に 20 個のプロシージャを表示する:
<PRE>
   readprofile | sort -nr +2 | head -20

</PRE>


ファイルシステムプロファイルのみを表示する:
<PRE>
   readprofile | grep _ext2

</PRE>


全てのカーネル情報を RAM アドレス付きで見る:
<PRE>
   readprofile -av | less

</PRE>


現在のカーネルのものではない「凍結した」プロファイリングバッファを見る:
<PRE>
   readprofile -p ~/profile.freeze -m /zImage.map.gz

</PRE>


CPU 毎に 2kHz でプロファイリングを行い、プロファイリングバッファをリセットする:
<PRE>
   sudo readprofile -M 20
</PRE>


<A NAME="lbAJ">&nbsp;</A>
<H2>入手方法</H2>






readprofile コマンドは util-linux パッケージの一部であり、

Linux Kernel Archive

から入手できる。
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">名前</A><DD>
<DT><A HREF="#lbAC">書式</A><DD>
<DT><A HREF="#lbAD">バージョン</A><DD>
<DT><A HREF="#lbAE">説明</A><DD>
<DT><A HREF="#lbAF">オプション</A><DD>
<DT><A HREF="#lbAG">ファイル</A><DD>
<DT><A HREF="#lbAH">バグ</A><DD>
<DT><A HREF="#lbAI">例</A><DD>
<DT><A HREF="#lbAJ">入手方法</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 12:15:07 GMT, February 04, 2021
</BODY>
</HTML>
