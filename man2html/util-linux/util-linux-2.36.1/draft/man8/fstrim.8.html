<HTML>
  <HEAD>
  <META CHARSET="UTF-8"/>
  <META HTTP-QUIV="Content-Type" CONTENT="text/html; charset=UTF-8"/>
  <LINK REL="stylesheet" TYPE="text/css"
	    HREF="../../../../css/jm-draft.css"/>
  <TITLE>Manpage of FSTRIM</TITLE>
</HEAD><BODY>
<H1>FSTRIM</H1>
Section: System Administration (8)<BR>Updated: May 2019<BR><A HREF="#index">Index</A>
<A HREF="https://github.com/ysatoautonomous/jm-draft/wiki">Return to Main Contents</A><HR>


<A NAME="lbAB">&nbsp;</A>
<H2>名前</H2>


fstrim - マウントされているファイルシステムの未使用ブロックを破棄する。

<A NAME="lbAC">&nbsp;</A>
<H2>書式</H2>

<B>fstrim</B>

[<B>-Aa</B>]

[<B>-o</B>

<I>offset</I>]

[<B>-l</B>

<I>length</I>]

[<B>-m</B>

<I>minimum-size</I>]

[<B>-v</B>]

<I>mountpoint</I>

<P>

<A NAME="lbAD">&nbsp;</A>
<H2>説明</H2>





<B>fstrim</B>

はマウントされているファイルシステムに対して使用され、
ファイルシステムで使われていないブロックを破棄 (または切り詰め &quot;trim&quot;) する。
これは、ソリッドステートドライブ (SSD) とシンプロビジョニングされたストレージで役立つ。
<P>





デフォルトでは、
<B>fstrim</B>

はファイルシステム上の全ての未使用ブロックを破棄する。
以下に示すように、この挙動はオプションを使って範囲やサイズに基づくように
変更できる。
<P>





<I>mountpoint</I>

引き数は、ファイルシステムがマウントされるディレクトリのパス名である。
<P>







<B>fstrim</B>

を頻繁に実行したり、
<B>mount -o discard</B>

を使うことですら、品質の悪い SSD デバイスに対しては、寿命に悪影響を与える可能性がある。
大部分のデスクトップとサーバーシステムでは、
切り詰めの頻度は 1 週間に 1 回で充分である。



全てのデバイスがキューイングされた切り詰め (queued trim) をサポートしている訳ではないので、
各切り詰めコマンドで、その時々にディスクを使おうとするので、性能上の
ペナルティーを招く。
<P>

<A NAME="lbAE">&nbsp;</A>
<H2>オプション</H2>






<I>offset</I>, <I>length</I>, <I>minimum-size</I> 引き数には、
倍数のサフィックス KiB (=1024),
MiB (=1024*1024), GiB, TiB, PiB, EiB, ZiB, YiB を付けることができる
(&quot;iB&quot; はオプションであり、例えば &quot;K&quot; は &quot;KiB&quot; と同じ意味である)。
またサフィックス KB (=1000), MB (=1000*1000), GB, TB, PB, EB, ZB, YB を
付けることもできる。
<P>
<DL COMPACT>
<DT><B>-A, --fstab</B><DD>



<I>/etc/fstab</I> にあるマウントされている全てのファイルシステムに対して、
デバイスが破棄操作をサポートしている場合は、切り詰めを行う。
このファイルにルートファイルシステムが書かれていない場合は、
カーネルのコマンドラインで決定する。


<B>--offset</B>, <B>--length</B>,
<B>--minimum</B> などの他に指定されたオプションは、全てのデバイスに適用される。


破棄操作をサポートしていないファイルシステム、読み込みのみの
デバイス、読み込みのみのファイルシステムからのエラーは、
黙って無視される。
<DT><B>-a, --all</B><DD>

マウントされている全てのファイルシステムに対して、
デバイスが破棄操作をサポートしている場合は、切り詰めを行う。


<B>--offset</B>, <B>--length</B>,
<B>--minimum</B> などの他に指定されたオプションは、全てのデバイスに適用される。


破棄操作をサポートしていないファイルシステム、読み込みのみの
デバイス、読み込みのみのファイルシステムからのエラーは、
黙って無視される。
<DT><B>-n, --dry-run</B><DD>

このオプションでは、実際に FITRIM ioctl を呼び出さない以外は、全てを実行する。
<DT><B>-o, --offset</B> <I>offset</I><DD>



破棄する空きブロックの検索を開始する、ファイルシステムのバイト
オフセット。
デフォルト値は 0 であり、ファイルシステムの先頭から開始する。
<DT><B>-l, --length</B> <I>length</I><DD>





破棄する空きブロックの検索を行う (開始点からの) バイト数。
指定した値がファイルシステムの終端を越した場合、
<B>fstrim</B>

はファイルシステムサイズの境界で停止する。
デフォルト値はファイルシステムの終端までである。
<DT><B>-I, --listed-in</B> <I>list</I><DD>



fstab またはカーネルの mountinfo 形式で、
コロン区切りのファイルのリストを指定する。
存在しないファイルと空のファイルは、黙って無視される。
最初の空ではないファイルが見つかると <I>list</I> の評価を止める。
例: <B>--listed-in /etc/fstab:/proc/self/mountinfo</B>.
<DT><B>-m, --minimum</B> <I>minimum-size</I><DD>




破棄する連続した最小の空き範囲 (バイト数)。
(この値は、内部的には、ファイルシステムブロックサイズの倍数に
切り上げられる。)
指定した値より小さい空き範囲は無視される。
指定した値がデバイスの最小値より小さい場合、fstrim は最小値を調整し、
ユーザー空間に (fstrim_range.minlen) を返す。



ひどく断片化した空きスペースがあるファイルシステムに対して、
この値を大きくすると、fstrim 操作の完了が速くなるが、
全てのブロックが破棄される訳ではなくなる。
デフォルト値は 0 であり、全ての空きブロックを破棄する。
<DT><B>-v, --verbose</B><DD>







詳細なメッセージを出して実行する。
このオプションを指定すると、
<B>fstrim</B>

は破棄される可能性があるためにファイルシステムから、
ブロックスタックを介して、デバイスに渡されたバイト数を表示する。
これはストレージデバイスの観点からみた、破棄される総量の最大値
である。
なぜなら、繰り返しの
<I>FITRIM</I>

ioctl 呼び出しでは、繰り返し破棄するために、同じセクタを送り続けるから
である。
<P>









<B>fstrim</B>

は破棄の可能性のある同じバイトを毎回表示するが、
破棄の間に書き込まれたセクタのみが、ストレージデバイスによって
実際に破棄される。
さらに、カーネルのブロックレイヤには、破棄範囲を調整する機能がある。
これは、RAID ストライプジオメトリ、または
LVM 設定で切り詰め不可にされたデバイスに合わせるためである。
これによるバイト数の減少は、fstrim_range.len
(<B>--length</B>

オプション) に反映されない。
<DT><B>--quiet-unsupported</B>

<DD>








trim 操作 (ioctl) がサポートされていない場合、エラーメッセージを抑止する。
このオプションは、systemd サービスファイル、または cron スクリプトで
既知の問題に起因する警告を隠すために使われる。
既知の問題とは、デバイスが読み込みのみでマウントされた場合、
またはファイルシステムが ioctl FITRIM の呼び出しをサポートしていない場合、
NTFS ドライバが
<I>不正なファイルディスクリプタ (bad file descriptor)</I>

であることを表示することなどである。
<DT><B>-V</B>,<B> --version</B>

<DD>

バージョン情報を表示して、終了する。
<DT><B>-h</B>,<B> --help</B>

<DD>

ヘルプを表示して、終了する。
<P>

</DL>
<A NAME="lbAF">&nbsp;</A>
<H2>返り値</H2>

<DL COMPACT>
<DT>0<DD>

成功
<DT>1<DD>

失敗
<DT>32<DD>

全て失敗
<DT>64<DD>

一部のファイルシステムでの破棄は成功して、一部では失敗した
</DL>
<P>




コマンド
<B>fstrim --all</B>

は 0 (全て成功), 32 (全て失敗), 64 (一部失敗、一部成功) を返す。
<P>

<A NAME="lbAG">&nbsp;</A>
<H2>著者</H2>

<PRE>
Lukas Czerner &lt;<A HREF="mailto:lczerner@redhat.com">lczerner@redhat.com</A>&gt;
Karel Zak &lt;<A HREF="mailto:kzak@redhat.com">kzak@redhat.com</A>&gt;
</PRE>


<A NAME="lbAH">&nbsp;</A>
<H2>関連項目</H2>

<B><A HREF="../man8/blkdiscard.8.html">blkdiscard</A></B>(8),

<B><A HREF="../man8/mount.8.html">mount</A></B>(8)


<A NAME="lbAI">&nbsp;</A>
<H2>入手方法</H2>



fstrim コマンドは util-linux パッケージの一部であり、
<A HREF="https://www.kernel.org/pub/linux/utils/util-linux/">https://www.kernel.org/pub/linux/utils/util-linux/</A>
から入手できる。
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">名前</A><DD>
<DT><A HREF="#lbAC">書式</A><DD>
<DT><A HREF="#lbAD">説明</A><DD>
<DT><A HREF="#lbAE">オプション</A><DD>
<DT><A HREF="#lbAF">返り値</A><DD>
<DT><A HREF="#lbAG">著者</A><DD>
<DT><A HREF="#lbAH">関連項目</A><DD>
<DT><A HREF="#lbAI">入手方法</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 14:44:36 GMT, February 02, 2021
</BODY>
</HTML>
