<HTML>
  <HEAD>
  <META CHARSET="UTF-8"/>
  <META HTTP-QUIV="Content-Type" CONTENT="text/html; charset=UTF-8"/>
  <LINK REL="stylesheet" TYPE="text/css"
	    HREF="../../../../css/jm-draft.css"/>
  <TITLE>Manpage of GETOPT</TITLE>
</HEAD><BODY>
<H1>GETOPT</H1>
Section: User Commands (1)<BR>Updated: December 2014<BR><A HREF="#index">Index</A>
<A HREF="https://github.com/ysatoautonomous/jm-draft/wiki">Return to Main Contents</A><HR>


<A NAME="lbAB">&nbsp;</A>
<H2>名前</H2>


getopt - コマンドの引き数を解析する (拡張版)

<A NAME="lbAC">&nbsp;</A>
<H2>書式</H2>

<B>getopt</B>

<I>optstring parameters</I>

<BR>

<B>getopt</B>

[options]
[<B>--</B>]

<I>optstring parameters</I>

<BR>

<B>getopt</B>

[options]
<B>-o</B>|<B>--options</B>

<I>optstring</I>

[options]
[<B>--</B>]

<I>parameters</I>


<A NAME="lbAD">&nbsp;</A>
<H2>説明</H2>









<B>getopt</B>

は、シェル手続きで簡単に解析できるように、
コマンドラインのオプションを分解
(<I>解析</I>)

するために使われる。
また、正しいオプションであるかを調べるためにも使われる。
これを行うために
<FONT SIZE="-1">GNU</FONT>
<B><A HREF="../man3/getopt.3.html">getopt</A></B>(3)

ルーチンが使われる。
<P>
















<B>getopt</B>

を呼び出すときに使われたパラメータは、
2 つの部分に分けることができる:
<B>getopt</B>

の解析動作を変更するオプション
(<B>「書式」</B>

セクションの
<I>options</I>

と
<I>optstring</I>)

と、解析されるパラメータ
(<B>「書式」</B>

セクションの
<I>parameters</I>)

である。









第 2 部分は、
最初のオプションではないパラメータ
(オプション引き数ではないもの) の後か、
最初の
<B>' -- '</B>

の後から始まる。
第 1 部分に
'<B>-o</B>'

または
'<B>--options</B>'

オプションが見つからない場合、
第 2 部分の最初のパラメータは
短い形式のオプション文字列として使われる。
<P>












環境変数
<B>GETOPT_COMPATIBLE</B>

が設定された場合、
または最初のパラメータがオプションでなかった場合
('<B>-</B>'

で始まっていない場合。
これは
<B>「書式」</B>

セクションの最初の形式である)、
<B>getopt</B>

は他のバージョンの
<B><A HREF="../man1/getopt.1.html">getopt</A></B>(1)

と互換性のある出力を生成する。




この場合でも、パラメータの並べ替えを行い、オプション引き数を認識する
(詳細は
<B>「互換性」</B>

セクションを参照すること)。
<P>














伝統的な
<B><A HREF="../man1/getopt.1.html">getopt</A></B>(1)

の実装では、引き数やオプションではないパラメータで
空白と他の (シェル特有の) 特殊文字を組み合わせて使うことができない。
この問題を解決するため、
この実装ではクォートした出力を生成する。
この出力は、シェル (通常は
<B>eval</B>

コマンドが使われる) によって再び解析されなければならない。
これにはクォートすべき文字列を保護するという効果があるが、
<B>getopt</B>

を他のバージョンとは互換性のない方法
(<B>「書式」</B>

セクションの 2, 3 番目の形式) で呼び出さなければならない。





拡張版の
<B><A HREF="../man1/getopt.1.html">getopt</A></B>(1)

がインストールされているかどうかを調べるには、特別なテストオプション
(<B>-T</B>)

を使うことができる。

<A NAME="lbAE">&nbsp;</A>
<H2>オプション</H2>

<DL COMPACT>
<DT><B>-a</B>,<B> --alternative</B>

<DD>


長いオプションを 1 個の
'<B>-</B>'

で始めることができるようにする。
<DT><B>-h</B>,<B> --help</B>

<DD>

ヘルプを表示して、終了する。
それ以上は何も出力されない。
<DT><B>-l</B>,<B> --longoptions </B><I>longopts</I>

<DD>








認識させる長い (複数文字の) オプションを指定する。
2 つ以上のオプション名をコンマで区切って一度に指定できる。
このオプションは 2 回以上指定することができる。
<I>longopts </I>

は交換可能である。
<I>longopts </I>

で指定されている長いオプション名の後に、1 個のコロンを続けることができる。
これは、そのオプションに引き数が必須であることを示す。
また、長いオプション名の後に 2 個のコロンを続けることもできる。
これは、そのオプションが引き数を取る場合もあることを示す。
<DT><B>-n</B>,<B> --name </B><I>progname</I>

<DD>





エラーが報告された場合に
<B><A HREF="../man3/getopt.3.html">getopt</A></B>(3)

ルーチンが使うプログラム名。
このオプションを指定しても、
<B><A HREF="../man1/getopt.1.html">getopt</A></B>(1)

のエラーは getopt から発生したものとして表示される点に注意すること。
<DT><B>-o</B>,<B> --options </B><I>shortopts</I>

<DD>






認識させる短い (1 文字の) オプションを指定する。
このオプションが指定されていない場合、
<B>getopt </B>

の 1 個の
'<B>-</B>'

で始まっていない最初のパラメータ (かつ、オプションの引き数でないもの) が
短いオプションの文字列として使われる。












<I>shortopts </I>

に指定されている短いオプション文字の後に、1 個のコロンを続けることができる。
これは、そのオプションに引き数が必須であることを示す。
また、長いオプション名の後に 2 個のコロンを続けることもできる。
これは、そのオプションが引き数を取る場合もあることを示す。
オプションの解析法と出力の生成法を変更するために、
shortopts の最初の文字を
'<B>+</B>'

または
'<B>-</B>'

にすることができる
(詳細は
<B>「スキャンモード」</B>

セクションを参照すること)。
<DT><B>-q</B>,<B> --quiet</B>

<DD>

<A HREF="../man3/getopt.3.html">getopt</A>(3) によるエラー表示をさせない。
<DT><B>-Q</B>,<B> --quiet-output</B>

<DD>




通常の出力を生成させない。
<I>-q</I>

を指定しない限り、
<B><A HREF="../man3/getopt.3.html">getopt</A></B>(3)

によってエラーが表示される。
<DT><B>-s</B>,<B> --shell </B><I>shell</I>

<DD>










指定したシェルのクォート方法に設定する。
-s オプションが指定されていない場合、
<FONT SIZE="-1">BASH</FONT>
でのクォート方法が使われる。
指定可能な引き数は、現在のところ
'<B>sh</B>',

'<B>bash</B>',

'<B>csh</B>',

'<B>tcsh</B>'

である。
<DT><B>-T</B>,<B> --test</B>

<DD>










<B><A HREF="../man1/getopt.1.html">getopt</A></B>(1)

が拡張バージョンか古いバージョンかをテストする。
何も出力しないが、エラーステータスを 4 に設定する。
他の
<B><A HREF="../man1/getopt.1.html">getopt</A></B>(1)

の実装の場合や、このバージョンで環境変数
<B>GETOPT_COMPATIBLE</B>

が設定されている場合、
'<B>--</B>'

を返し、エラーステータスを 0 に設定する。
<DT><B>-u</B>,<B> --unquoted</B>

<DD>





出力をクォートしない。
空白と (シェル依存の) 特殊文字は、(他の
<B><A HREF="../man1/getopt.1.html">getopt</A></B>(1)

の実装と同じように) このモードでは大混乱を引き起こす。
<DT><B>-V</B>,<B> --version</B>

<DD>

バージョン情報を表示して、終了する。
それ以上は何も出力されない。

</DL>
<A NAME="lbAF">&nbsp;</A>
<H2>解析</H2>








このセクションでは
<B>getopt</B>

のパラメータの第 2 部分
(<B>「書式」</B>

セクションの
<I>parameters</I>)

のフォーマットについて説明している。









次のセクション
(<B>出力</B>)

では生成される出力について説明している。
これらのパラメータは、一般に、シェル関数が呼ばれたときのパラメータである。
シェル関数が呼ばれたときの各パラメータが
<B>getopt </B>

のパラメータリストにある 1 つのパラメータに
厳密に対応している点に注意しなければならない
(<B>「例」</B>

セクションを参照すること)。



全ての解析が GNU 
<B><A HREF="../man3/getopt.3.html">getopt</A></B>(3)

ルーチンで行われる。
<P>




パラメータは左から右へ解析される。
各パラメータは、短いオプション・長いオプション・オプションへの引き数・
オプションではないパラメータに分類される。
<P>








簡単な短いオプションは、
'<B>-</B>'

の後に短いオプション文字が続くものである。
オプションが引き数を必須としている場合、
引き数はオプション文字の直後に書くことができる。
(コマンドライン上で空白で区切られた) 次のパラメータとして書くこともできる。
オプションが引き数を取ることも取らないこともできる場合、
引き数が存在するならば、オプション文字の直後に書かなければならない。
<P>





(最後のオプションを除く) 全てのオプションが
必須の引き数もオプションとしての引き数も必要としない限り、
1 個の
'<B>-</B>'

の後に複数の短いオプションを指定することができる。
<P>
















長いオプションは、通常
'<B>--</B>'

の後に長いオプション名が続く。
オプションが引き数を必須としている場合、
'<B>=</B>'

で区切って長いオプション名の直後に書くことができる。
また、(コマンドライン上で空白で区切って) 次の引き数として書くこともできる。
オプションが引き数を取ることも取らないこともできる場合、
引き数が存在するならば、
'<B>=</B>'

で区切って長いオプション名の直後に書かなければならない
('<B>=</B>'

をオプションの後に書いたにも関らず、その後に何も指定しなかった場合、
引き数が存在しないものとして解釈される。
これはちょっとしたバグである。
<B>「バグ」</B>

セクションを参照すること)。


長いオプションは、省略形が曖昧でない (他のオプションと区別がつく) 限り、
短く省略することができる。
<P>













'<B>-</B>'

で始まらず、かつ前のオプションが必須としている引き数でもないパラメータは、
オプションではないパラメータである。
'<B>--</B>'

パラメータの後にあるパラメータは、
オプションではないパラメータとして解釈される。
環境変数
<B>POSIXLY_CORRECT </B>

が設定されている場合、
または短いオプション文字列が
'<B>+</B>'

で始まっている場合、
最初のオプションではないパラメータが見つかった時点で、
残りの全てのパラメータはオプションではないパラメータとして解釈される。

<A NAME="lbAG">&nbsp;</A>
<H2>出力</H2>










出力は前のセクションで説明した各要素に対して生成される。
出力は要素が入力で指定された順番で生成される。
ただし、オプションではないパラメータは例外である。
出力は
<I>互換</I>

(<I>クォートされない</I>)

モードで生成することができる。
また、引き数とオプションではないパラメータに含まれる空白と他の特殊文字を
保護するモードで出力することもできる
(<B>「クォート」</B>

セクションを参照すること)。





出力がシェルスクリプトで処理される場合、
その出力は別々の要素から構成されているようにみえる。
この要素は (大部分のシェル言語では shift コマンドを使って)
1 つ 1 つ処理できる。
この動作はクォートされないモードでは不完全である。
なぜなら、要素に空白や特殊文字があった場合、
要素が期待していない箇所で分割されてしまうからである。
<P>





必須とされる引き数が見つからない、またはオプションが認識されない、
といった原因でパラメータ解析に問題がある場合、
標準エラーにエラーが表示される。
このとき、不正な要素に対しては何も出力されず、
0 でないエラーステータスが返される。
<P>











短いオプションに対して、出力として 1 個の
'<B>-</B>'

とオプション文字が生成される。
オプションが引き数を取る場合、次のパラメータが引き数になる。
オプションが引き数を取っても取らなくてもよい場合に、
引き数が指定されていないと、
クォートモードでは次のパラメータが生成されるが空のパラメータになる。
この場合、クォートしない (互換) モードでは
2 番目のパラメータは生成されない。
他の多くの
<B><A HREF="../man1/getopt.1.html">getopt</A></B>(1)

の実装では、取っても取らなくてもよい引き数は
サポートされていない点に注意すること。
<P>




複数の短いオプションが 1 個の
'<B>-</B>'

の後に指定されている場合、
各オプションは区切られたパラメータとして出力に表示される。
<P>








長いオプションに対して、
'<B>--</B>'

と完全なオプション名が 1 つのパラメータとして生成される。
「入力でオプションが略書きされている。
または、オプションが 1 個の
'<B>-</B>'

を使って指定されている。」ということに関らず、この動作をする。
引き数は短いオプションとして扱われる。
<P>

















通常、全てのオプションとその引き数が出力に生成されるまで、
オプションではないパラメータは出力されない。
そして、1 個のパラメータとして
'<B>--</B>'

が生成される。
その後にオプションではないパラメータは、
見つかった順番で別々のパラメータとして生成される。
短いオプション文字列の最初の文字が
'<B>-</B>'

である場合にのみ、
オプションではないパラメータは入力で見つかった位置で出力される
(この動作は
<B>「書式」</B>

セクションの最初の形式が使われた場合にはサポートされない。
この場合、
'<B>-</B>'

と
'<B>+</B>'

が前に付く全てのパラメータが無視される)。

<A NAME="lbAH">&nbsp;</A>
<H2>クォート</H2>










互換モードでは、引き数やオプションではないパラメータにある
空白や「特殊」文字は正しく扱われない。
この出力はシェルスクリプトに与えられるので、
スクリプトは、出力をどのようにして個々のパラメータに
分割すべきなのかを知らない。
この問題を回避するため、この実装ではクォート機能を提供する。
これは、各パラメータをクォートして出力を生成する、という手法を取る。
この出力がもう一度シェル (通常はシェルの
<B>eval</B>

コマンド) に与えられた場合、
出力は個々のパラメータに正しく分割される。
<P>








環境変数
<B>GETOPT_COMPATIBLE</B>

が設定された場合・
<B>「書式」</B>

セクションの最初の形式が使われた場合・
'<B>-u</B>'

オプションが指定された場合、クォートは行われない。
<P>














クォートの規則はシェルごとに異なる。
使用しているシェルを選択するために
'<B>-s</B>'

オプションを使うことができる。
以下のシェルで正しく機能する:
'<B>sh</B>',

'<B>bash</B>',

'<B>csh</B>'<B>,</B>

'<B>tcsh</B>'.

実際には、2 つの「方式」に分類される:
sh 式のクォート規則と csh 式のクォート規則である。
他のシェルスクリプト言語を使っている場合でも、
これらの方式のどちらかが使える可能性がある。
<P>

<A NAME="lbAI">&nbsp;</A>
<H2>スキャンモード</H2>











特殊なスキャンモードであることを示すために、
短いオプションの最初の文字を
'<B>-</B>'

または
'<B>+</B>'

にすることができる。
<B>「書式」</B>

セクションの最初の呼び出し形式が使われた場合、これは無視される。
しかし、環境変数
<B>POSIXLY_CORRECT</B>

が指定されているかどうかは調べられる。
<P>










最初の文字が
'<B>+</B>'

の場合、または環境変数
<B>POSIXLY_CORRECT</B>

が設定されている場合、オプションではない最初のパラメータ
(つまり、
'<B>-</B>'

で始まっていないパラメータ) が
オプション引き数でないと分かった時点で解析はストップする。
それ以降の全てのパラメータは、オプションではないパラメータとして解釈される。
<P>











最初の文字が
'<B>-</B>'

の場合、オプションではない引き数は見つかった箇所で出力される。
通常の操作では、
'<B>--</B>'

パラメータが生成された後で、最後にまとめて出力される。
この場合でも
'<B>--</B>'

パラメータは生成されるが、
通常このモードでは最後のパラメータになる点に注意すること。

<A NAME="lbAJ">&nbsp;</A>
<H2>互換性</H2>






このバージョンの
<B><A HREF="../man1/getopt.1.html">getopt</A></B>(1)

は、出来るだけ他のバージョンと互換性があるように書かれた。
通常は他のバージョンを修正することなく、
このバージョンに置き換えることができる。
更に、いくつかの利点がある。
<P>











getopt の最初のパラメータの最初の文字が
'<B>-</B>'

でない場合、getopt は互換モードになる。
最初のパラメータは短いオプションの文字列として解釈され、
他の全ての引き数が解析される。
この場合でも、環境変数
<B>POSIXLY_CORRECT </B>

が設定されていない限り、パラメータの並べ替えを行う
(つまり、オプションではない全てのパラメータが最後に出力される)。
<P>









環境変数
<B>GETOPT_COMPATIBLE </B>

は
<B>getopt</B>

を強制的に互換モードにする。
この環境変数と
<B>POSIXLY_CORRECT</B>

の両方を設定すると、「難しい」プログラムのために 100% の互換性を提供する。
しかし、通常はどちらも設定する必要がない。
<P>






互換モードでは、短いオプション文字列の最初に付く
'<B>-</B>'

と
'<B>+</B>'

は無視される。

<A NAME="lbAK">&nbsp;</A>
<H2>返り値</H2>
















解析に成功した場合、
<B>getopt</B>

はエラーコード
<B>0 </B>

を返す。
<B><A HREF="../man3/getopt.3.html">getopt</A></B>(3)

がエラーを返した場合は
<B>1</B>

を返す。
パラメータが理解できなかった場合は
<B>2 </B>

を返す。
メモリが足りない (out-of-memory) といった内部エラーの場合は
<B>3</B>

を返す。
<B>-T</B>

オプションを付けて呼び出された場合は
<B>4</B>

を返す。

<A NAME="lbAL">&nbsp;</A>
<H2>例</H2>






(ba)sh と (t)csh での使用例のスクリプトは、
<B><A HREF="../man1/getopt.1.html">getopt</A></B>(1)

ディストリビューションで提供されており、
<I>/usr/share/doc/util-linux/getopt/</I>

にインストールされている。

<A NAME="lbAM">&nbsp;</A>
<H2>環境変数</H2>

<DL COMPACT>
<DT>POSIXLY_CORRECT<DD>







この環境変数は
<B><A HREF="../man3/getopt.3.html">getopt</A></B>(3)

ルーチンで調べられる。
これが設定されている場合、パラメータがオプションまたは
オプション引き数でないと分かった時点で解析は停止する。
それ以降の全てのパラメータは、
'<B>-</B>'

で始まっているかどうかに関係なく、
オプションではないパラメータとして解釈される。
<DT>GETOPT_COMPATIBLE<DD>




<B>getopt</B>

に対して強制的に
<B>「書式」</B>

セクションの最初の呼び出し形式を使わせる。

</DL>
<A NAME="lbAN">&nbsp;</A>
<H2>バグ</H2>







<B><A HREF="../man3/getopt.3.html">getopt</A></B>(3)

は、引き数を取っても取らなくてもよい長いオプションを解析できる
(ただし、短いオプションの場合は解析できない)。
この
<B><A HREF="../man1/getopt.1.html">getopt</A></B>(1)

は、オプション引き数が指定されていない場合、それが存在しないものとして扱う。
<P>




短いオプション変数を全く使いたくない場合、
書式は全く直感的でないものになる
(明示的に空の文字列に設定する必要がある)。

<A NAME="lbAO">&nbsp;</A>
<H2>著者</H2>


Frodo Looijaard


<A NAME="lbAP">&nbsp;</A>
<H2>関連項目</H2>

<B><A HREF="../man1/bash.1.html">bash</A></B>(1),

<B><A HREF="../man1/tcsh.1.html">tcsh</A></B>(1),

<B><A HREF="../man3/getopt.3.html">getopt</A></B>(3)


<A NAME="lbAQ">&nbsp;</A>
<H2>入手方法</H2>





getopt コマンドは、util-linux パッケージの一部であり、

Linux Kernel Archive

から入手できる。
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">名前</A><DD>
<DT><A HREF="#lbAC">書式</A><DD>
<DT><A HREF="#lbAD">説明</A><DD>
<DT><A HREF="#lbAE">オプション</A><DD>
<DT><A HREF="#lbAF">解析</A><DD>
<DT><A HREF="#lbAG">出力</A><DD>
<DT><A HREF="#lbAH">クォート</A><DD>
<DT><A HREF="#lbAI">スキャンモード</A><DD>
<DT><A HREF="#lbAJ">互換性</A><DD>
<DT><A HREF="#lbAK">返り値</A><DD>
<DT><A HREF="#lbAL">例</A><DD>
<DT><A HREF="#lbAM">環境変数</A><DD>
<DT><A HREF="#lbAN">バグ</A><DD>
<DT><A HREF="#lbAO">著者</A><DD>
<DT><A HREF="#lbAP">関連項目</A><DD>
<DT><A HREF="#lbAQ">入手方法</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 13:53:33 GMT, January 19, 2021
</BODY>
</HTML>
